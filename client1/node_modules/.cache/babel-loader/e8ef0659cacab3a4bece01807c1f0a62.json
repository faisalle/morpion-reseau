{"ast":null,"code":"'use strict';\n\nvar Stream = require('stream').Stream,\n    util = require('util'),\n    driver = require('websocket-driver'),\n    Headers = require('websocket-driver/lib/websocket/driver/headers'),\n    API = require('./websocket/api'),\n    EventTarget = require('./websocket/api/event_target'),\n    Event = require('./websocket/api/event');\n\nvar EventSource = function (request, response, options) {\n  this.writable = true;\n  options = options || {};\n  this._stream = response.socket;\n  this._ping = options.ping || this.DEFAULT_PING;\n  this._retry = options.retry || this.DEFAULT_RETRY;\n  var scheme = driver.isSecureRequest(request) ? 'https:' : 'http:';\n  this.url = scheme + '//' + request.headers.host + request.url;\n  this.lastEventId = request.headers['last-event-id'] || '';\n  this.readyState = API.CONNECTING;\n  var headers = new Headers(),\n      self = this;\n\n  if (options.headers) {\n    for (var key in options.headers) headers.set(key, options.headers[key]);\n  }\n\n  if (!this._stream || !this._stream.writable) return;\n  process.nextTick(function () {\n    self._open();\n  });\n\n  this._stream.setTimeout(0);\n\n  this._stream.setNoDelay(true);\n\n  var handshake = 'HTTP/1.1 200 OK\\r\\n' + 'Content-Type: text/event-stream\\r\\n' + 'Cache-Control: no-cache, no-store\\r\\n' + 'Connection: close\\r\\n' + headers.toString() + '\\r\\n' + 'retry: ' + Math.floor(this._retry * 1000) + '\\r\\n\\r\\n';\n\n  this._write(handshake);\n\n  this._stream.on('drain', function () {\n    self.emit('drain');\n  });\n\n  if (this._ping) this._pingTimer = setInterval(function () {\n    self.ping();\n  }, this._ping * 1000);\n  ['error', 'end'].forEach(function (event) {\n    self._stream.on(event, function () {\n      self.close();\n    });\n  });\n};\n\nutil.inherits(EventSource, Stream);\n\nEventSource.isEventSource = function (request) {\n  if (request.method !== 'GET') return false;\n  var accept = (request.headers.accept || '').split(/\\s*,\\s*/);\n  return accept.indexOf('text/event-stream') >= 0;\n};\n\nvar instance = {\n  DEFAULT_PING: 10,\n  DEFAULT_RETRY: 5,\n  _write: function (chunk) {\n    if (!this.writable) return false;\n\n    try {\n      return this._stream.write(chunk, 'utf8');\n    } catch (e) {\n      return false;\n    }\n  },\n  _open: function () {\n    if (this.readyState !== API.CONNECTING) return;\n    this.readyState = API.OPEN;\n    var event = new Event('open');\n    event.initEvent('open', false, false);\n    this.dispatchEvent(event);\n  },\n  write: function (message) {\n    return this.send(message);\n  },\n  end: function (message) {\n    if (message !== undefined) this.write(message);\n    this.close();\n  },\n  send: function (message, options) {\n    if (this.readyState > API.OPEN) return false;\n    message = String(message).replace(/(\\r\\n|\\r|\\n)/g, '$1data: ');\n    options = options || {};\n    var frame = '';\n    if (options.event) frame += 'event: ' + options.event + '\\r\\n';\n    if (options.id) frame += 'id: ' + options.id + '\\r\\n';\n    frame += 'data: ' + message + '\\r\\n\\r\\n';\n    return this._write(frame);\n  },\n  ping: function () {\n    return this._write(':\\r\\n\\r\\n');\n  },\n  close: function () {\n    if (this.readyState > API.OPEN) return false;\n    this.readyState = API.CLOSED;\n    this.writable = false;\n    if (this._pingTimer) clearInterval(this._pingTimer);\n    if (this._stream) this._stream.end();\n    var event = new Event('close');\n    event.initEvent('close', false, false);\n    this.dispatchEvent(event);\n    return true;\n  }\n};\n\nfor (var method in instance) EventSource.prototype[method] = instance[method];\n\nfor (var key in EventTarget) EventSource.prototype[key] = EventTarget[key];\n\nmodule.exports = EventSource;","map":{"version":3,"names":["Stream","require","util","driver","Headers","API","EventTarget","Event","EventSource","request","response","options","writable","_stream","socket","_ping","ping","DEFAULT_PING","_retry","retry","DEFAULT_RETRY","scheme","isSecureRequest","url","headers","host","lastEventId","readyState","CONNECTING","self","key","set","process","nextTick","_open","setTimeout","setNoDelay","handshake","toString","Math","floor","_write","on","emit","_pingTimer","setInterval","forEach","event","close","inherits","isEventSource","method","accept","split","indexOf","instance","chunk","write","e","OPEN","initEvent","dispatchEvent","message","send","end","undefined","String","replace","frame","id","CLOSED","clearInterval","prototype","module","exports"],"sources":["/home/faisal/ServerExample/client/client/node_modules/faye-websocket/lib/faye/eventsource.js"],"sourcesContent":["'use strict';\n\nvar Stream      = require('stream').Stream,\n    util        = require('util'),\n    driver      = require('websocket-driver'),\n    Headers     = require('websocket-driver/lib/websocket/driver/headers'),\n    API         = require('./websocket/api'),\n    EventTarget = require('./websocket/api/event_target'),\n    Event       = require('./websocket/api/event');\n\nvar EventSource = function(request, response, options) {\n  this.writable = true;\n  options = options || {};\n\n  this._stream = response.socket;\n  this._ping   = options.ping  || this.DEFAULT_PING;\n  this._retry  = options.retry || this.DEFAULT_RETRY;\n\n  var scheme       = driver.isSecureRequest(request) ? 'https:' : 'http:';\n  this.url         = scheme + '//' + request.headers.host + request.url;\n  this.lastEventId = request.headers['last-event-id'] || '';\n  this.readyState  = API.CONNECTING;\n\n  var headers = new Headers(),\n      self    = this;\n\n  if (options.headers) {\n    for (var key in options.headers) headers.set(key, options.headers[key]);\n  }\n\n  if (!this._stream || !this._stream.writable) return;\n  process.nextTick(function() { self._open() });\n\n  this._stream.setTimeout(0);\n  this._stream.setNoDelay(true);\n\n  var handshake = 'HTTP/1.1 200 OK\\r\\n' +\n                  'Content-Type: text/event-stream\\r\\n' +\n                  'Cache-Control: no-cache, no-store\\r\\n' +\n                  'Connection: close\\r\\n' +\n                  headers.toString() +\n                  '\\r\\n' +\n                  'retry: ' + Math.floor(this._retry * 1000) + '\\r\\n\\r\\n';\n\n  this._write(handshake);\n\n  this._stream.on('drain', function() { self.emit('drain') });\n\n  if (this._ping)\n    this._pingTimer = setInterval(function() { self.ping() }, this._ping * 1000);\n\n  ['error', 'end'].forEach(function(event) {\n    self._stream.on(event, function() { self.close() });\n  });\n};\nutil.inherits(EventSource, Stream);\n\nEventSource.isEventSource = function(request) {\n  if (request.method !== 'GET') return false;\n  var accept = (request.headers.accept || '').split(/\\s*,\\s*/);\n  return accept.indexOf('text/event-stream') >= 0;\n};\n\nvar instance = {\n  DEFAULT_PING:   10,\n  DEFAULT_RETRY:  5,\n\n  _write: function(chunk) {\n    if (!this.writable) return false;\n    try {\n      return this._stream.write(chunk, 'utf8');\n    } catch (e) {\n      return false;\n    }\n  },\n\n  _open: function() {\n    if (this.readyState !== API.CONNECTING) return;\n\n    this.readyState = API.OPEN;\n\n    var event = new Event('open');\n    event.initEvent('open', false, false);\n    this.dispatchEvent(event);\n  },\n\n  write: function(message) {\n    return this.send(message);\n  },\n\n  end: function(message) {\n    if (message !== undefined) this.write(message);\n    this.close();\n  },\n\n  send: function(message, options) {\n    if (this.readyState > API.OPEN) return false;\n\n    message = String(message).replace(/(\\r\\n|\\r|\\n)/g, '$1data: ');\n    options = options || {};\n\n    var frame = '';\n    if (options.event) frame += 'event: ' + options.event + '\\r\\n';\n    if (options.id)    frame += 'id: '    + options.id    + '\\r\\n';\n    frame += 'data: ' + message + '\\r\\n\\r\\n';\n\n    return this._write(frame);\n  },\n\n  ping: function() {\n    return this._write(':\\r\\n\\r\\n');\n  },\n\n  close: function() {\n    if (this.readyState > API.OPEN) return false;\n\n    this.readyState = API.CLOSED;\n    this.writable = false;\n    if (this._pingTimer) clearInterval(this._pingTimer);\n    if (this._stream) this._stream.end();\n\n    var event = new Event('close');\n    event.initEvent('close', false, false);\n    this.dispatchEvent(event);\n\n    return true;\n  }\n};\n\nfor (var method in instance) EventSource.prototype[method] = instance[method];\nfor (var key in EventTarget) EventSource.prototype[key] = EventTarget[key];\n\nmodule.exports = EventSource;\n"],"mappings":"AAAA;;AAEA,IAAIA,MAAM,GAAQC,OAAO,CAAC,QAAD,CAAP,CAAkBD,MAApC;AAAA,IACIE,IAAI,GAAUD,OAAO,CAAC,MAAD,CADzB;AAAA,IAEIE,MAAM,GAAQF,OAAO,CAAC,kBAAD,CAFzB;AAAA,IAGIG,OAAO,GAAOH,OAAO,CAAC,+CAAD,CAHzB;AAAA,IAIII,GAAG,GAAWJ,OAAO,CAAC,iBAAD,CAJzB;AAAA,IAKIK,WAAW,GAAGL,OAAO,CAAC,8BAAD,CALzB;AAAA,IAMIM,KAAK,GAASN,OAAO,CAAC,uBAAD,CANzB;;AAQA,IAAIO,WAAW,GAAG,UAASC,OAAT,EAAkBC,QAAlB,EAA4BC,OAA5B,EAAqC;EACrD,KAAKC,QAAL,GAAgB,IAAhB;EACAD,OAAO,GAAGA,OAAO,IAAI,EAArB;EAEA,KAAKE,OAAL,GAAeH,QAAQ,CAACI,MAAxB;EACA,KAAKC,KAAL,GAAeJ,OAAO,CAACK,IAAR,IAAiB,KAAKC,YAArC;EACA,KAAKC,MAAL,GAAeP,OAAO,CAACQ,KAAR,IAAiB,KAAKC,aAArC;EAEA,IAAIC,MAAM,GAASlB,MAAM,CAACmB,eAAP,CAAuBb,OAAvB,IAAkC,QAAlC,GAA6C,OAAhE;EACA,KAAKc,GAAL,GAAmBF,MAAM,GAAG,IAAT,GAAgBZ,OAAO,CAACe,OAAR,CAAgBC,IAAhC,GAAuChB,OAAO,CAACc,GAAlE;EACA,KAAKG,WAAL,GAAmBjB,OAAO,CAACe,OAAR,CAAgB,eAAhB,KAAoC,EAAvD;EACA,KAAKG,UAAL,GAAmBtB,GAAG,CAACuB,UAAvB;EAEA,IAAIJ,OAAO,GAAG,IAAIpB,OAAJ,EAAd;EAAA,IACIyB,IAAI,GAAM,IADd;;EAGA,IAAIlB,OAAO,CAACa,OAAZ,EAAqB;IACnB,KAAK,IAAIM,GAAT,IAAgBnB,OAAO,CAACa,OAAxB,EAAiCA,OAAO,CAACO,GAAR,CAAYD,GAAZ,EAAiBnB,OAAO,CAACa,OAAR,CAAgBM,GAAhB,CAAjB;EAClC;;EAED,IAAI,CAAC,KAAKjB,OAAN,IAAiB,CAAC,KAAKA,OAAL,CAAaD,QAAnC,EAA6C;EAC7CoB,OAAO,CAACC,QAAR,CAAiB,YAAW;IAAEJ,IAAI,CAACK,KAAL;EAAc,CAA5C;;EAEA,KAAKrB,OAAL,CAAasB,UAAb,CAAwB,CAAxB;;EACA,KAAKtB,OAAL,CAAauB,UAAb,CAAwB,IAAxB;;EAEA,IAAIC,SAAS,GAAG,wBACA,qCADA,GAEA,uCAFA,GAGA,uBAHA,GAIAb,OAAO,CAACc,QAAR,EAJA,GAKA,MALA,GAMA,SANA,GAMYC,IAAI,CAACC,KAAL,CAAW,KAAKtB,MAAL,GAAc,IAAzB,CANZ,GAM6C,UAN7D;;EAQA,KAAKuB,MAAL,CAAYJ,SAAZ;;EAEA,KAAKxB,OAAL,CAAa6B,EAAb,CAAgB,OAAhB,EAAyB,YAAW;IAAEb,IAAI,CAACc,IAAL,CAAU,OAAV;EAAoB,CAA1D;;EAEA,IAAI,KAAK5B,KAAT,EACE,KAAK6B,UAAL,GAAkBC,WAAW,CAAC,YAAW;IAAEhB,IAAI,CAACb,IAAL;EAAa,CAA3B,EAA6B,KAAKD,KAAL,GAAa,IAA1C,CAA7B;EAEF,CAAC,OAAD,EAAU,KAAV,EAAiB+B,OAAjB,CAAyB,UAASC,KAAT,EAAgB;IACvClB,IAAI,CAAChB,OAAL,CAAa6B,EAAb,CAAgBK,KAAhB,EAAuB,YAAW;MAAElB,IAAI,CAACmB,KAAL;IAAc,CAAlD;EACD,CAFD;AAGD,CA5CD;;AA6CA9C,IAAI,CAAC+C,QAAL,CAAczC,WAAd,EAA2BR,MAA3B;;AAEAQ,WAAW,CAAC0C,aAAZ,GAA4B,UAASzC,OAAT,EAAkB;EAC5C,IAAIA,OAAO,CAAC0C,MAAR,KAAmB,KAAvB,EAA8B,OAAO,KAAP;EAC9B,IAAIC,MAAM,GAAG,CAAC3C,OAAO,CAACe,OAAR,CAAgB4B,MAAhB,IAA0B,EAA3B,EAA+BC,KAA/B,CAAqC,SAArC,CAAb;EACA,OAAOD,MAAM,CAACE,OAAP,CAAe,mBAAf,KAAuC,CAA9C;AACD,CAJD;;AAMA,IAAIC,QAAQ,GAAG;EACbtC,YAAY,EAAI,EADH;EAEbG,aAAa,EAAG,CAFH;EAIbqB,MAAM,EAAE,UAASe,KAAT,EAAgB;IACtB,IAAI,CAAC,KAAK5C,QAAV,EAAoB,OAAO,KAAP;;IACpB,IAAI;MACF,OAAO,KAAKC,OAAL,CAAa4C,KAAb,CAAmBD,KAAnB,EAA0B,MAA1B,CAAP;IACD,CAFD,CAEE,OAAOE,CAAP,EAAU;MACV,OAAO,KAAP;IACD;EACF,CAXY;EAabxB,KAAK,EAAE,YAAW;IAChB,IAAI,KAAKP,UAAL,KAAoBtB,GAAG,CAACuB,UAA5B,EAAwC;IAExC,KAAKD,UAAL,GAAkBtB,GAAG,CAACsD,IAAtB;IAEA,IAAIZ,KAAK,GAAG,IAAIxC,KAAJ,CAAU,MAAV,CAAZ;IACAwC,KAAK,CAACa,SAAN,CAAgB,MAAhB,EAAwB,KAAxB,EAA+B,KAA/B;IACA,KAAKC,aAAL,CAAmBd,KAAnB;EACD,CArBY;EAuBbU,KAAK,EAAE,UAASK,OAAT,EAAkB;IACvB,OAAO,KAAKC,IAAL,CAAUD,OAAV,CAAP;EACD,CAzBY;EA2BbE,GAAG,EAAE,UAASF,OAAT,EAAkB;IACrB,IAAIA,OAAO,KAAKG,SAAhB,EAA2B,KAAKR,KAAL,CAAWK,OAAX;IAC3B,KAAKd,KAAL;EACD,CA9BY;EAgCbe,IAAI,EAAE,UAASD,OAAT,EAAkBnD,OAAlB,EAA2B;IAC/B,IAAI,KAAKgB,UAAL,GAAkBtB,GAAG,CAACsD,IAA1B,EAAgC,OAAO,KAAP;IAEhCG,OAAO,GAAGI,MAAM,CAACJ,OAAD,CAAN,CAAgBK,OAAhB,CAAwB,eAAxB,EAAyC,UAAzC,CAAV;IACAxD,OAAO,GAAGA,OAAO,IAAI,EAArB;IAEA,IAAIyD,KAAK,GAAG,EAAZ;IACA,IAAIzD,OAAO,CAACoC,KAAZ,EAAmBqB,KAAK,IAAI,YAAYzD,OAAO,CAACoC,KAApB,GAA4B,MAArC;IACnB,IAAIpC,OAAO,CAAC0D,EAAZ,EAAmBD,KAAK,IAAI,SAAYzD,OAAO,CAAC0D,EAApB,GAA4B,MAArC;IACnBD,KAAK,IAAI,WAAWN,OAAX,GAAqB,UAA9B;IAEA,OAAO,KAAKrB,MAAL,CAAY2B,KAAZ,CAAP;EACD,CA5CY;EA8CbpD,IAAI,EAAE,YAAW;IACf,OAAO,KAAKyB,MAAL,CAAY,WAAZ,CAAP;EACD,CAhDY;EAkDbO,KAAK,EAAE,YAAW;IAChB,IAAI,KAAKrB,UAAL,GAAkBtB,GAAG,CAACsD,IAA1B,EAAgC,OAAO,KAAP;IAEhC,KAAKhC,UAAL,GAAkBtB,GAAG,CAACiE,MAAtB;IACA,KAAK1D,QAAL,GAAgB,KAAhB;IACA,IAAI,KAAKgC,UAAT,EAAqB2B,aAAa,CAAC,KAAK3B,UAAN,CAAb;IACrB,IAAI,KAAK/B,OAAT,EAAkB,KAAKA,OAAL,CAAamD,GAAb;IAElB,IAAIjB,KAAK,GAAG,IAAIxC,KAAJ,CAAU,OAAV,CAAZ;IACAwC,KAAK,CAACa,SAAN,CAAgB,OAAhB,EAAyB,KAAzB,EAAgC,KAAhC;IACA,KAAKC,aAAL,CAAmBd,KAAnB;IAEA,OAAO,IAAP;EACD;AA/DY,CAAf;;AAkEA,KAAK,IAAII,MAAT,IAAmBI,QAAnB,EAA6B/C,WAAW,CAACgE,SAAZ,CAAsBrB,MAAtB,IAAgCI,QAAQ,CAACJ,MAAD,CAAxC;;AAC7B,KAAK,IAAIrB,GAAT,IAAgBxB,WAAhB,EAA6BE,WAAW,CAACgE,SAAZ,CAAsB1C,GAAtB,IAA6BxB,WAAW,CAACwB,GAAD,CAAxC;;AAE7B2C,MAAM,CAACC,OAAP,GAAiBlE,WAAjB"},"metadata":{},"sourceType":"script"}