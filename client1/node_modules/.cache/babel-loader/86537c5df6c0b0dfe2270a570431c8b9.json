{"ast":null,"code":"'use strict';\n\nvar Buffer = require('safe-buffer').Buffer,\n    crypto = require('crypto'),\n    url = require('url'),\n    util = require('util'),\n    HttpParser = require('../http_parser'),\n    Base = require('./base'),\n    Hybi = require('./hybi'),\n    Proxy = require('./proxy');\n\nvar Client = function (_url, options) {\n  this.version = 'hybi-' + Hybi.VERSION;\n  Hybi.call(this, null, _url, options);\n  this.readyState = -1;\n  this._key = Client.generateKey();\n  this._accept = Hybi.generateAccept(this._key);\n  this._http = new HttpParser('response');\n  var uri = url.parse(this.url),\n      auth = uri.auth && Buffer.from(uri.auth, 'utf8').toString('base64');\n  if (this.VALID_PROTOCOLS.indexOf(uri.protocol) < 0) throw new Error(this.url + ' is not a valid WebSocket URL');\n  this._pathname = (uri.pathname || '/') + (uri.search || '');\n\n  this._headers.set('Host', uri.host);\n\n  this._headers.set('Upgrade', 'websocket');\n\n  this._headers.set('Connection', 'Upgrade');\n\n  this._headers.set('Sec-WebSocket-Key', this._key);\n\n  this._headers.set('Sec-WebSocket-Version', Hybi.VERSION);\n\n  if (this._protocols.length > 0) this._headers.set('Sec-WebSocket-Protocol', this._protocols.join(', '));\n  if (auth) this._headers.set('Authorization', 'Basic ' + auth);\n};\n\nutil.inherits(Client, Hybi);\n\nClient.generateKey = function () {\n  return crypto.randomBytes(16).toString('base64');\n};\n\nvar instance = {\n  VALID_PROTOCOLS: ['ws:', 'wss:'],\n  proxy: function (origin, options) {\n    return new Proxy(this, origin, options);\n  },\n  start: function () {\n    if (this.readyState !== -1) return false;\n\n    this._write(this._handshakeRequest());\n\n    this.readyState = 0;\n    return true;\n  },\n  parse: function (chunk) {\n    if (this.readyState === 3) return;\n    if (this.readyState > 0) return Hybi.prototype.parse.call(this, chunk);\n\n    this._http.parse(chunk);\n\n    if (!this._http.isComplete()) return;\n\n    this._validateHandshake();\n\n    if (this.readyState === 3) return;\n\n    this._open();\n\n    this.parse(this._http.body);\n  },\n  _handshakeRequest: function () {\n    var extensions = this._extensions.generateOffer();\n\n    if (extensions) this._headers.set('Sec-WebSocket-Extensions', extensions);\n    var start = 'GET ' + this._pathname + ' HTTP/1.1',\n        headers = [start, this._headers.toString(), ''];\n    return Buffer.from(headers.join('\\r\\n'), 'utf8');\n  },\n  _failHandshake: function (message) {\n    message = 'Error during WebSocket handshake: ' + message;\n    this.readyState = 3;\n    this.emit('error', new Error(message));\n    this.emit('close', new Base.CloseEvent(this.ERRORS.protocol_error, message));\n  },\n  _validateHandshake: function () {\n    this.statusCode = this._http.statusCode;\n    this.headers = this._http.headers;\n    if (this._http.error) return this._failHandshake(this._http.error.message);\n    if (this._http.statusCode !== 101) return this._failHandshake('Unexpected response code: ' + this._http.statusCode);\n    var headers = this._http.headers,\n        upgrade = headers['upgrade'] || '',\n        connection = headers['connection'] || '',\n        accept = headers['sec-websocket-accept'] || '',\n        protocol = headers['sec-websocket-protocol'] || '';\n    if (upgrade === '') return this._failHandshake(\"'Upgrade' header is missing\");\n    if (upgrade.toLowerCase() !== 'websocket') return this._failHandshake(\"'Upgrade' header value is not 'WebSocket'\");\n    if (connection === '') return this._failHandshake(\"'Connection' header is missing\");\n    if (connection.toLowerCase() !== 'upgrade') return this._failHandshake(\"'Connection' header value is not 'Upgrade'\");\n    if (accept !== this._accept) return this._failHandshake('Sec-WebSocket-Accept mismatch');\n    this.protocol = null;\n\n    if (protocol !== '') {\n      if (this._protocols.indexOf(protocol) < 0) return this._failHandshake('Sec-WebSocket-Protocol mismatch');else this.protocol = protocol;\n    }\n\n    try {\n      this._extensions.activate(this.headers['sec-websocket-extensions']);\n    } catch (e) {\n      return this._failHandshake(e.message);\n    }\n  }\n};\n\nfor (var key in instance) Client.prototype[key] = instance[key];\n\nmodule.exports = Client;","map":{"version":3,"names":["Buffer","require","crypto","url","util","HttpParser","Base","Hybi","Proxy","Client","_url","options","version","VERSION","call","readyState","_key","generateKey","_accept","generateAccept","_http","uri","parse","auth","from","toString","VALID_PROTOCOLS","indexOf","protocol","Error","_pathname","pathname","search","_headers","set","host","_protocols","length","join","inherits","randomBytes","instance","proxy","origin","start","_write","_handshakeRequest","chunk","prototype","isComplete","_validateHandshake","_open","body","extensions","_extensions","generateOffer","headers","_failHandshake","message","emit","CloseEvent","ERRORS","protocol_error","statusCode","error","upgrade","connection","accept","toLowerCase","activate","e","key","module","exports"],"sources":["/home/faisal/ServerExample/client/client/node_modules/websocket-driver/lib/websocket/driver/client.js"],"sourcesContent":["'use strict';\n\nvar Buffer     = require('safe-buffer').Buffer,\n    crypto     = require('crypto'),\n    url        = require('url'),\n    util       = require('util'),\n    HttpParser = require('../http_parser'),\n    Base       = require('./base'),\n    Hybi       = require('./hybi'),\n    Proxy      = require('./proxy');\n\nvar Client = function(_url, options) {\n  this.version = 'hybi-' + Hybi.VERSION;\n  Hybi.call(this, null, _url, options);\n\n  this.readyState = -1;\n  this._key       = Client.generateKey();\n  this._accept    = Hybi.generateAccept(this._key);\n  this._http      = new HttpParser('response');\n\n  var uri  = url.parse(this.url),\n      auth = uri.auth && Buffer.from(uri.auth, 'utf8').toString('base64');\n\n  if (this.VALID_PROTOCOLS.indexOf(uri.protocol) < 0)\n    throw new Error(this.url + ' is not a valid WebSocket URL');\n\n  this._pathname = (uri.pathname || '/') + (uri.search || '');\n\n  this._headers.set('Host', uri.host);\n  this._headers.set('Upgrade', 'websocket');\n  this._headers.set('Connection', 'Upgrade');\n  this._headers.set('Sec-WebSocket-Key', this._key);\n  this._headers.set('Sec-WebSocket-Version', Hybi.VERSION);\n\n  if (this._protocols.length > 0)\n    this._headers.set('Sec-WebSocket-Protocol', this._protocols.join(', '));\n\n  if (auth)\n    this._headers.set('Authorization', 'Basic ' + auth);\n};\nutil.inherits(Client, Hybi);\n\nClient.generateKey = function() {\n  return crypto.randomBytes(16).toString('base64');\n};\n\nvar instance = {\n  VALID_PROTOCOLS: ['ws:', 'wss:'],\n\n  proxy: function(origin, options) {\n    return new Proxy(this, origin, options);\n  },\n\n  start: function() {\n    if (this.readyState !== -1) return false;\n    this._write(this._handshakeRequest());\n    this.readyState = 0;\n    return true;\n  },\n\n  parse: function(chunk) {\n    if (this.readyState === 3) return;\n    if (this.readyState > 0) return Hybi.prototype.parse.call(this, chunk);\n\n    this._http.parse(chunk);\n    if (!this._http.isComplete()) return;\n\n    this._validateHandshake();\n    if (this.readyState === 3) return;\n\n    this._open();\n    this.parse(this._http.body);\n  },\n\n  _handshakeRequest: function() {\n    var extensions = this._extensions.generateOffer();\n    if (extensions)\n      this._headers.set('Sec-WebSocket-Extensions', extensions);\n\n    var start   = 'GET ' + this._pathname + ' HTTP/1.1',\n        headers = [start, this._headers.toString(), ''];\n\n    return Buffer.from(headers.join('\\r\\n'), 'utf8');\n  },\n\n  _failHandshake: function(message) {\n    message = 'Error during WebSocket handshake: ' + message;\n    this.readyState = 3;\n    this.emit('error', new Error(message));\n    this.emit('close', new Base.CloseEvent(this.ERRORS.protocol_error, message));\n  },\n\n  _validateHandshake: function() {\n    this.statusCode = this._http.statusCode;\n    this.headers    = this._http.headers;\n\n    if (this._http.error)\n      return this._failHandshake(this._http.error.message);\n\n    if (this._http.statusCode !== 101)\n      return this._failHandshake('Unexpected response code: ' + this._http.statusCode);\n\n    var headers    = this._http.headers,\n        upgrade    = headers['upgrade'] || '',\n        connection = headers['connection'] || '',\n        accept     = headers['sec-websocket-accept'] || '',\n        protocol   = headers['sec-websocket-protocol'] || '';\n\n    if (upgrade === '')\n      return this._failHandshake(\"'Upgrade' header is missing\");\n    if (upgrade.toLowerCase() !== 'websocket')\n      return this._failHandshake(\"'Upgrade' header value is not 'WebSocket'\");\n\n    if (connection === '')\n      return this._failHandshake(\"'Connection' header is missing\");\n    if (connection.toLowerCase() !== 'upgrade')\n      return this._failHandshake(\"'Connection' header value is not 'Upgrade'\");\n\n    if (accept !== this._accept)\n      return this._failHandshake('Sec-WebSocket-Accept mismatch');\n\n    this.protocol = null;\n\n    if (protocol !== '') {\n      if (this._protocols.indexOf(protocol) < 0)\n        return this._failHandshake('Sec-WebSocket-Protocol mismatch');\n      else\n        this.protocol = protocol;\n    }\n\n    try {\n      this._extensions.activate(this.headers['sec-websocket-extensions']);\n    } catch (e) {\n      return this._failHandshake(e.message);\n    }\n  }\n};\n\nfor (var key in instance)\n  Client.prototype[key] = instance[key];\n\nmodule.exports = Client;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}