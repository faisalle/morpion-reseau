{"ast":null,"code":"'use strict';\n\nvar Buffer = require('safe-buffer').Buffer,\n    Stream = require('stream').Stream,\n    url = require('url'),\n    util = require('util'),\n    Base = require('./base'),\n    Headers = require('./headers'),\n    HttpParser = require('../http_parser');\n\nvar PORTS = {\n  'ws:': 80,\n  'wss:': 443\n};\n\nvar Proxy = function (client, origin, options) {\n  this._client = client;\n  this._http = new HttpParser('response');\n  this._origin = typeof client.url === 'object' ? client.url : url.parse(client.url);\n  this._url = typeof origin === 'object' ? origin : url.parse(origin);\n  this._options = options || {};\n  this._state = 0;\n  this.readable = this.writable = true;\n  this._paused = false;\n  this._headers = new Headers();\n\n  this._headers.set('Host', this._origin.host);\n\n  this._headers.set('Connection', 'keep-alive');\n\n  this._headers.set('Proxy-Connection', 'keep-alive');\n\n  var auth = this._url.auth && Buffer.from(this._url.auth, 'utf8').toString('base64');\n  if (auth) this._headers.set('Proxy-Authorization', 'Basic ' + auth);\n};\n\nutil.inherits(Proxy, Stream);\nvar instance = {\n  setHeader: function (name, value) {\n    if (this._state !== 0) return false;\n\n    this._headers.set(name, value);\n\n    return true;\n  },\n  start: function () {\n    if (this._state !== 0) return false;\n    this._state = 1;\n    var origin = this._origin,\n        port = origin.port || PORTS[origin.protocol],\n        start = 'CONNECT ' + origin.hostname + ':' + port + ' HTTP/1.1';\n    var headers = [start, this._headers.toString(), ''];\n    this.emit('data', Buffer.from(headers.join('\\r\\n'), 'utf8'));\n    return true;\n  },\n  pause: function () {\n    this._paused = true;\n  },\n  resume: function () {\n    this._paused = false;\n    this.emit('drain');\n  },\n  write: function (chunk) {\n    if (!this.writable) return false;\n\n    this._http.parse(chunk);\n\n    if (!this._http.isComplete()) return !this._paused;\n    this.statusCode = this._http.statusCode;\n    this.headers = this._http.headers;\n\n    if (this.statusCode === 200) {\n      this.emit('connect', new Base.ConnectEvent());\n    } else {\n      var message = \"Can't establish a connection to the server at \" + this._origin.href;\n      this.emit('error', new Error(message));\n    }\n\n    this.end();\n    return !this._paused;\n  },\n  end: function (chunk) {\n    if (!this.writable) return;\n    if (chunk !== undefined) this.write(chunk);\n    this.readable = this.writable = false;\n    this.emit('close');\n    this.emit('end');\n  },\n  destroy: function () {\n    this.end();\n  }\n};\n\nfor (var key in instance) Proxy.prototype[key] = instance[key];\n\nmodule.exports = Proxy;","map":{"version":3,"names":["Buffer","require","Stream","url","util","Base","Headers","HttpParser","PORTS","Proxy","client","origin","options","_client","_http","_origin","parse","_url","_options","_state","readable","writable","_paused","_headers","set","host","auth","from","toString","inherits","instance","setHeader","name","value","start","port","protocol","hostname","headers","emit","join","pause","resume","write","chunk","isComplete","statusCode","ConnectEvent","message","href","Error","end","undefined","destroy","key","prototype","module","exports"],"sources":["/home/faisal/ServerExample/client/client/node_modules/websocket-driver/lib/websocket/driver/proxy.js"],"sourcesContent":["'use strict';\n\nvar Buffer     = require('safe-buffer').Buffer,\n    Stream     = require('stream').Stream,\n    url        = require('url'),\n    util       = require('util'),\n    Base       = require('./base'),\n    Headers    = require('./headers'),\n    HttpParser = require('../http_parser');\n\nvar PORTS = { 'ws:': 80, 'wss:': 443 };\n\nvar Proxy = function(client, origin, options) {\n  this._client  = client;\n  this._http    = new HttpParser('response');\n  this._origin  = (typeof client.url === 'object') ? client.url : url.parse(client.url);\n  this._url     = (typeof origin === 'object') ? origin : url.parse(origin);\n  this._options = options || {};\n  this._state   = 0;\n\n  this.readable = this.writable = true;\n  this._paused  = false;\n\n  this._headers = new Headers();\n  this._headers.set('Host', this._origin.host);\n  this._headers.set('Connection', 'keep-alive');\n  this._headers.set('Proxy-Connection', 'keep-alive');\n\n  var auth = this._url.auth && Buffer.from(this._url.auth, 'utf8').toString('base64');\n  if (auth) this._headers.set('Proxy-Authorization', 'Basic ' + auth);\n};\nutil.inherits(Proxy, Stream);\n\nvar instance = {\n  setHeader: function(name, value) {\n    if (this._state !== 0) return false;\n    this._headers.set(name, value);\n    return true;\n  },\n\n  start: function() {\n    if (this._state !== 0) return false;\n    this._state = 1;\n\n    var origin = this._origin,\n        port   = origin.port || PORTS[origin.protocol],\n        start  = 'CONNECT ' + origin.hostname + ':' + port + ' HTTP/1.1';\n\n    var headers = [start, this._headers.toString(), ''];\n\n    this.emit('data', Buffer.from(headers.join('\\r\\n'), 'utf8'));\n    return true;\n  },\n\n  pause: function() {\n    this._paused = true;\n  },\n\n  resume: function() {\n    this._paused = false;\n    this.emit('drain');\n  },\n\n  write: function(chunk) {\n    if (!this.writable) return false;\n\n    this._http.parse(chunk);\n    if (!this._http.isComplete()) return !this._paused;\n\n    this.statusCode = this._http.statusCode;\n    this.headers    = this._http.headers;\n\n    if (this.statusCode === 200) {\n      this.emit('connect', new Base.ConnectEvent());\n    } else {\n      var message = \"Can't establish a connection to the server at \" + this._origin.href;\n      this.emit('error', new Error(message));\n    }\n    this.end();\n    return !this._paused;\n  },\n\n  end: function(chunk) {\n    if (!this.writable) return;\n    if (chunk !== undefined) this.write(chunk);\n    this.readable = this.writable = false;\n    this.emit('close');\n    this.emit('end');\n  },\n\n  destroy: function() {\n    this.end();\n  }\n};\n\nfor (var key in instance)\n  Proxy.prototype[key] = instance[key];\n\nmodule.exports = Proxy;\n"],"mappings":"AAAA;;AAEA,IAAIA,MAAM,GAAOC,OAAO,CAAC,aAAD,CAAP,CAAuBD,MAAxC;AAAA,IACIE,MAAM,GAAOD,OAAO,CAAC,QAAD,CAAP,CAAkBC,MADnC;AAAA,IAEIC,GAAG,GAAUF,OAAO,CAAC,KAAD,CAFxB;AAAA,IAGIG,IAAI,GAASH,OAAO,CAAC,MAAD,CAHxB;AAAA,IAIII,IAAI,GAASJ,OAAO,CAAC,QAAD,CAJxB;AAAA,IAKIK,OAAO,GAAML,OAAO,CAAC,WAAD,CALxB;AAAA,IAMIM,UAAU,GAAGN,OAAO,CAAC,gBAAD,CANxB;;AAQA,IAAIO,KAAK,GAAG;EAAE,OAAO,EAAT;EAAa,QAAQ;AAArB,CAAZ;;AAEA,IAAIC,KAAK,GAAG,UAASC,MAAT,EAAiBC,MAAjB,EAAyBC,OAAzB,EAAkC;EAC5C,KAAKC,OAAL,GAAgBH,MAAhB;EACA,KAAKI,KAAL,GAAgB,IAAIP,UAAJ,CAAe,UAAf,CAAhB;EACA,KAAKQ,OAAL,GAAiB,OAAOL,MAAM,CAACP,GAAd,KAAsB,QAAvB,GAAmCO,MAAM,CAACP,GAA1C,GAAgDA,GAAG,CAACa,KAAJ,CAAUN,MAAM,CAACP,GAAjB,CAAhE;EACA,KAAKc,IAAL,GAAiB,OAAON,MAAP,KAAkB,QAAnB,GAA+BA,MAA/B,GAAwCR,GAAG,CAACa,KAAJ,CAAUL,MAAV,CAAxD;EACA,KAAKO,QAAL,GAAgBN,OAAO,IAAI,EAA3B;EACA,KAAKO,MAAL,GAAgB,CAAhB;EAEA,KAAKC,QAAL,GAAgB,KAAKC,QAAL,GAAgB,IAAhC;EACA,KAAKC,OAAL,GAAgB,KAAhB;EAEA,KAAKC,QAAL,GAAgB,IAAIjB,OAAJ,EAAhB;;EACA,KAAKiB,QAAL,CAAcC,GAAd,CAAkB,MAAlB,EAA0B,KAAKT,OAAL,CAAaU,IAAvC;;EACA,KAAKF,QAAL,CAAcC,GAAd,CAAkB,YAAlB,EAAgC,YAAhC;;EACA,KAAKD,QAAL,CAAcC,GAAd,CAAkB,kBAAlB,EAAsC,YAAtC;;EAEA,IAAIE,IAAI,GAAG,KAAKT,IAAL,CAAUS,IAAV,IAAkB1B,MAAM,CAAC2B,IAAP,CAAY,KAAKV,IAAL,CAAUS,IAAtB,EAA4B,MAA5B,EAAoCE,QAApC,CAA6C,QAA7C,CAA7B;EACA,IAAIF,IAAJ,EAAU,KAAKH,QAAL,CAAcC,GAAd,CAAkB,qBAAlB,EAAyC,WAAWE,IAApD;AACX,CAlBD;;AAmBAtB,IAAI,CAACyB,QAAL,CAAcpB,KAAd,EAAqBP,MAArB;AAEA,IAAI4B,QAAQ,GAAG;EACbC,SAAS,EAAE,UAASC,IAAT,EAAeC,KAAf,EAAsB;IAC/B,IAAI,KAAKd,MAAL,KAAgB,CAApB,EAAuB,OAAO,KAAP;;IACvB,KAAKI,QAAL,CAAcC,GAAd,CAAkBQ,IAAlB,EAAwBC,KAAxB;;IACA,OAAO,IAAP;EACD,CALY;EAObC,KAAK,EAAE,YAAW;IAChB,IAAI,KAAKf,MAAL,KAAgB,CAApB,EAAuB,OAAO,KAAP;IACvB,KAAKA,MAAL,GAAc,CAAd;IAEA,IAAIR,MAAM,GAAG,KAAKI,OAAlB;IAAA,IACIoB,IAAI,GAAKxB,MAAM,CAACwB,IAAP,IAAe3B,KAAK,CAACG,MAAM,CAACyB,QAAR,CADjC;IAAA,IAEIF,KAAK,GAAI,aAAavB,MAAM,CAAC0B,QAApB,GAA+B,GAA/B,GAAqCF,IAArC,GAA4C,WAFzD;IAIA,IAAIG,OAAO,GAAG,CAACJ,KAAD,EAAQ,KAAKX,QAAL,CAAcK,QAAd,EAAR,EAAkC,EAAlC,CAAd;IAEA,KAAKW,IAAL,CAAU,MAAV,EAAkBvC,MAAM,CAAC2B,IAAP,CAAYW,OAAO,CAACE,IAAR,CAAa,MAAb,CAAZ,EAAkC,MAAlC,CAAlB;IACA,OAAO,IAAP;EACD,CAnBY;EAqBbC,KAAK,EAAE,YAAW;IAChB,KAAKnB,OAAL,GAAe,IAAf;EACD,CAvBY;EAyBboB,MAAM,EAAE,YAAW;IACjB,KAAKpB,OAAL,GAAe,KAAf;IACA,KAAKiB,IAAL,CAAU,OAAV;EACD,CA5BY;EA8BbI,KAAK,EAAE,UAASC,KAAT,EAAgB;IACrB,IAAI,CAAC,KAAKvB,QAAV,EAAoB,OAAO,KAAP;;IAEpB,KAAKP,KAAL,CAAWE,KAAX,CAAiB4B,KAAjB;;IACA,IAAI,CAAC,KAAK9B,KAAL,CAAW+B,UAAX,EAAL,EAA8B,OAAO,CAAC,KAAKvB,OAAb;IAE9B,KAAKwB,UAAL,GAAkB,KAAKhC,KAAL,CAAWgC,UAA7B;IACA,KAAKR,OAAL,GAAkB,KAAKxB,KAAL,CAAWwB,OAA7B;;IAEA,IAAI,KAAKQ,UAAL,KAAoB,GAAxB,EAA6B;MAC3B,KAAKP,IAAL,CAAU,SAAV,EAAqB,IAAIlC,IAAI,CAAC0C,YAAT,EAArB;IACD,CAFD,MAEO;MACL,IAAIC,OAAO,GAAG,mDAAmD,KAAKjC,OAAL,CAAakC,IAA9E;MACA,KAAKV,IAAL,CAAU,OAAV,EAAmB,IAAIW,KAAJ,CAAUF,OAAV,CAAnB;IACD;;IACD,KAAKG,GAAL;IACA,OAAO,CAAC,KAAK7B,OAAb;EACD,CA/CY;EAiDb6B,GAAG,EAAE,UAASP,KAAT,EAAgB;IACnB,IAAI,CAAC,KAAKvB,QAAV,EAAoB;IACpB,IAAIuB,KAAK,KAAKQ,SAAd,EAAyB,KAAKT,KAAL,CAAWC,KAAX;IACzB,KAAKxB,QAAL,GAAgB,KAAKC,QAAL,GAAgB,KAAhC;IACA,KAAKkB,IAAL,CAAU,OAAV;IACA,KAAKA,IAAL,CAAU,KAAV;EACD,CAvDY;EAyDbc,OAAO,EAAE,YAAW;IAClB,KAAKF,GAAL;EACD;AA3DY,CAAf;;AA8DA,KAAK,IAAIG,GAAT,IAAgBxB,QAAhB,EACErB,KAAK,CAAC8C,SAAN,CAAgBD,GAAhB,IAAuBxB,QAAQ,CAACwB,GAAD,CAA/B;;AAEFE,MAAM,CAACC,OAAP,GAAiBhD,KAAjB"},"metadata":{},"sourceType":"script"}