{"ast":null,"code":"'use strict';\n\nvar Buffer = require('safe-buffer').Buffer,\n    Emitter = require('events').EventEmitter,\n    util = require('util'),\n    streams = require('../streams'),\n    Headers = require('./headers'),\n    Reader = require('./stream_reader');\n\nvar Base = function (request, url, options) {\n  Emitter.call(this);\n  Base.validateOptions(options || {}, ['maxLength', 'masking', 'requireMasking', 'protocols']);\n  this._request = request;\n  this._reader = new Reader();\n  this._options = options || {};\n  this._maxLength = this._options.maxLength || this.MAX_LENGTH;\n  this._headers = new Headers();\n  this.__queue = [];\n  this.readyState = 0;\n  this.url = url;\n  this.io = new streams.IO(this);\n  this.messages = new streams.Messages(this);\n\n  this._bindEventListeners();\n};\n\nutil.inherits(Base, Emitter);\n\nBase.isWebSocket = function (request) {\n  var connection = request.headers.connection || '',\n      upgrade = request.headers.upgrade || '';\n  return request.method === 'GET' && connection.toLowerCase().split(/ *, */).indexOf('upgrade') >= 0 && upgrade.toLowerCase() === 'websocket';\n};\n\nBase.validateOptions = function (options, validKeys) {\n  for (var key in options) {\n    if (validKeys.indexOf(key) < 0) throw new Error('Unrecognized option: ' + key);\n  }\n};\n\nvar instance = {\n  // This is 64MB, small enough for an average VPS to handle without\n  // crashing from process out of memory\n  MAX_LENGTH: 0x3ffffff,\n  STATES: ['connecting', 'open', 'closing', 'closed'],\n  _bindEventListeners: function () {\n    var self = this; // Protocol errors are informational and do not have to be handled\n\n    this.messages.on('error', function () {});\n    this.on('message', function (event) {\n      var messages = self.messages;\n      if (messages.readable) messages.emit('data', event.data);\n    });\n    this.on('error', function (error) {\n      var messages = self.messages;\n      if (messages.readable) messages.emit('error', error);\n    });\n    this.on('close', function () {\n      var messages = self.messages;\n      if (!messages.readable) return;\n      messages.readable = messages.writable = false;\n      messages.emit('end');\n    });\n  },\n  getState: function () {\n    return this.STATES[this.readyState] || null;\n  },\n  addExtension: function (extension) {\n    return false;\n  },\n  setHeader: function (name, value) {\n    if (this.readyState > 0) return false;\n\n    this._headers.set(name, value);\n\n    return true;\n  },\n  start: function () {\n    if (this.readyState !== 0) return false;\n    if (!Base.isWebSocket(this._request)) return this._failHandshake(new Error('Not a WebSocket request'));\n    var response;\n\n    try {\n      response = this._handshakeResponse();\n    } catch (error) {\n      return this._failHandshake(error);\n    }\n\n    this._write(response);\n\n    if (this._stage !== -1) this._open();\n    return true;\n  },\n  _failHandshake: function (error) {\n    var headers = new Headers();\n    headers.set('Content-Type', 'text/plain');\n    headers.set('Content-Length', Buffer.byteLength(error.message, 'utf8'));\n    headers = ['HTTP/1.1 400 Bad Request', headers.toString(), error.message];\n\n    this._write(Buffer.from(headers.join('\\r\\n'), 'utf8'));\n\n    this._fail('protocol_error', error.message);\n\n    return false;\n  },\n  text: function (message) {\n    return this.frame(message);\n  },\n  binary: function (message) {\n    return false;\n  },\n  ping: function () {\n    return false;\n  },\n  pong: function () {\n    return false;\n  },\n  close: function (reason, code) {\n    if (this.readyState !== 1) return false;\n    this.readyState = 3;\n    this.emit('close', new Base.CloseEvent(null, null));\n    return true;\n  },\n  _open: function () {\n    this.readyState = 1;\n\n    this.__queue.forEach(function (args) {\n      this.frame.apply(this, args);\n    }, this);\n\n    this.__queue = [];\n    this.emit('open', new Base.OpenEvent());\n  },\n  _queue: function (message) {\n    this.__queue.push(message);\n\n    return true;\n  },\n  _write: function (chunk) {\n    var io = this.io;\n    if (io.readable) io.emit('data', chunk);\n  },\n  _fail: function (type, message) {\n    this.readyState = 2;\n    this.emit('error', new Error(message));\n    this.close();\n  }\n};\n\nfor (var key in instance) Base.prototype[key] = instance[key];\n\nBase.ConnectEvent = function () {};\n\nBase.OpenEvent = function () {};\n\nBase.CloseEvent = function (code, reason) {\n  this.code = code;\n  this.reason = reason;\n};\n\nBase.MessageEvent = function (data) {\n  this.data = data;\n};\n\nBase.PingEvent = function (data) {\n  this.data = data;\n};\n\nBase.PongEvent = function (data) {\n  this.data = data;\n};\n\nmodule.exports = Base;","map":{"version":3,"names":["Buffer","require","Emitter","EventEmitter","util","streams","Headers","Reader","Base","request","url","options","call","validateOptions","_request","_reader","_options","_maxLength","maxLength","MAX_LENGTH","_headers","__queue","readyState","io","IO","messages","Messages","_bindEventListeners","inherits","isWebSocket","connection","headers","upgrade","method","toLowerCase","split","indexOf","validKeys","key","Error","instance","STATES","self","on","event","readable","emit","data","error","writable","getState","addExtension","extension","setHeader","name","value","set","start","_failHandshake","response","_handshakeResponse","_write","_stage","_open","byteLength","message","toString","from","join","_fail","text","frame","binary","ping","pong","close","reason","code","CloseEvent","forEach","args","apply","OpenEvent","_queue","push","chunk","type","prototype","ConnectEvent","MessageEvent","PingEvent","PongEvent","module","exports"],"sources":["/home/faisal/ServerExample/client/client/node_modules/websocket-driver/lib/websocket/driver/base.js"],"sourcesContent":["'use strict';\n\nvar Buffer  = require('safe-buffer').Buffer,\n    Emitter = require('events').EventEmitter,\n    util    = require('util'),\n    streams = require('../streams'),\n    Headers = require('./headers'),\n    Reader  = require('./stream_reader');\n\nvar Base = function(request, url, options) {\n  Emitter.call(this);\n  Base.validateOptions(options || {}, ['maxLength', 'masking', 'requireMasking', 'protocols']);\n\n  this._request   = request;\n  this._reader    = new Reader();\n  this._options   = options || {};\n  this._maxLength = this._options.maxLength || this.MAX_LENGTH;\n  this._headers   = new Headers();\n  this.__queue    = [];\n  this.readyState = 0;\n  this.url        = url;\n\n  this.io = new streams.IO(this);\n  this.messages = new streams.Messages(this);\n  this._bindEventListeners();\n};\nutil.inherits(Base, Emitter);\n\nBase.isWebSocket = function(request) {\n  var connection = request.headers.connection || '',\n      upgrade    = request.headers.upgrade || '';\n\n  return request.method === 'GET' &&\n         connection.toLowerCase().split(/ *, */).indexOf('upgrade') >= 0 &&\n         upgrade.toLowerCase() === 'websocket';\n};\n\nBase.validateOptions = function(options, validKeys) {\n  for (var key in options) {\n    if (validKeys.indexOf(key) < 0)\n      throw new Error('Unrecognized option: ' + key);\n  }\n};\n\nvar instance = {\n  // This is 64MB, small enough for an average VPS to handle without\n  // crashing from process out of memory\n  MAX_LENGTH: 0x3ffffff,\n\n  STATES: ['connecting', 'open', 'closing', 'closed'],\n\n  _bindEventListeners: function() {\n    var self = this;\n\n    // Protocol errors are informational and do not have to be handled\n    this.messages.on('error', function() {});\n\n    this.on('message', function(event) {\n      var messages = self.messages;\n      if (messages.readable) messages.emit('data', event.data);\n    });\n\n    this.on('error', function(error) {\n      var messages = self.messages;\n      if (messages.readable) messages.emit('error', error);\n    });\n\n    this.on('close', function() {\n      var messages = self.messages;\n      if (!messages.readable) return;\n      messages.readable = messages.writable = false;\n      messages.emit('end');\n    });\n  },\n\n  getState: function() {\n    return this.STATES[this.readyState] || null;\n  },\n\n  addExtension: function(extension) {\n    return false;\n  },\n\n  setHeader: function(name, value) {\n    if (this.readyState > 0) return false;\n    this._headers.set(name, value);\n    return true;\n  },\n\n  start: function() {\n    if (this.readyState !== 0) return false;\n\n    if (!Base.isWebSocket(this._request))\n      return this._failHandshake(new Error('Not a WebSocket request'));\n\n    var response;\n\n    try {\n      response = this._handshakeResponse();\n    } catch (error) {\n      return this._failHandshake(error);\n    }\n\n    this._write(response);\n    if (this._stage !== -1) this._open();\n    return true;\n  },\n\n  _failHandshake: function(error) {\n    var headers = new Headers();\n    headers.set('Content-Type', 'text/plain');\n    headers.set('Content-Length', Buffer.byteLength(error.message, 'utf8'));\n\n    headers = ['HTTP/1.1 400 Bad Request', headers.toString(), error.message];\n    this._write(Buffer.from(headers.join('\\r\\n'), 'utf8'));\n    this._fail('protocol_error', error.message);\n\n    return false;\n  },\n\n  text: function(message) {\n    return this.frame(message);\n  },\n\n  binary: function(message) {\n    return false;\n  },\n\n  ping: function() {\n    return false;\n  },\n\n  pong: function() {\n      return false;\n  },\n\n  close: function(reason, code) {\n    if (this.readyState !== 1) return false;\n    this.readyState = 3;\n    this.emit('close', new Base.CloseEvent(null, null));\n    return true;\n  },\n\n  _open: function() {\n    this.readyState = 1;\n    this.__queue.forEach(function(args) { this.frame.apply(this, args) }, this);\n    this.__queue = [];\n    this.emit('open', new Base.OpenEvent());\n  },\n\n  _queue: function(message) {\n    this.__queue.push(message);\n    return true;\n  },\n\n  _write: function(chunk) {\n    var io = this.io;\n    if (io.readable) io.emit('data', chunk);\n  },\n\n  _fail: function(type, message) {\n    this.readyState = 2;\n    this.emit('error', new Error(message));\n    this.close();\n  }\n};\n\nfor (var key in instance)\n  Base.prototype[key] = instance[key];\n\n\nBase.ConnectEvent = function() {};\n\nBase.OpenEvent = function() {};\n\nBase.CloseEvent = function(code, reason) {\n  this.code   = code;\n  this.reason = reason;\n};\n\nBase.MessageEvent = function(data) {\n  this.data = data;\n};\n\nBase.PingEvent = function(data) {\n  this.data = data;\n};\n\nBase.PongEvent = function(data) {\n  this.data = data;\n};\n\nmodule.exports = Base;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}